\section{Анализ предметной области разработки, сравнение с аналогами}

\subsection{Обзор предметной области}
Пакет 3Д-моделирования Blender - свободное и открытое программное обеспечение, предназначенное для создания трехмерной компьютерной графики. В список возможностей пакета входит:
\begin{itemize}
	\item моделирование
	\item скульптинг
	\item создание анимации
	\item симуляция
	\item рендеринг
	\item монтаж и обработка видео
	\item создание рисованной 2D-анимации
	\item встроенный редактор кода на языке Python, позволяющий взаимодействовать с пакетом Blender
\end{itemize}

На текущий момент Blender является одним из стандартов в области 3D-моделирования. Пакет широко применяется как в игровых студиях, таких как Ubisoft (серия "Assassin's Creed"), Epic (Unreal Engine, Fortnite), так и в телевизионных сериалах ("Человек в высоком замке", "Кремниевая долина", "Чужестранка") и полнометражных фильмах ("Хардкор", "Парк Юрского периода") \cite{guru-ytb}. Широкое применение получил в науке в области визуализации различных процессов и явлений.

В Blender предустановлено два движка для рендера Cycles и Eevee. Первый предназначен для рендера физически достоверных и сложных сцен, в которых важен реализм, правильное поведение света и отражений, но вычислительно затратен и не поддерживает отображение финального результата в реальном времени.

Движок Eevee, наоборот, специально создавался для версий Blender 2.8x и новее с учетом необходимости поддержки рендера в реальном времени. Хотя и почти все настройки сцены из Cycles подходят для Eevee, их движок просчитывает совершенно по другому, в значительно упрощенной вариации. Фактически движок Eevee по своему принципу работы создавался аналогично игровым движкам и спокойно поддерживает рендер в реальном времени, и поэтому именно Eevee был выбран в качестве движка рендера в данной работе.

В области захвата движений существуют два основных вида систем. Маркерные системы и безмаркерные.

Маркерная система захвата движений. В такой системе несколько камер снимают человека, одетого в специальный костюм с маркерами – датчиками. Человек как бы отыгрывает за виртуального персонажа его роль по сценарию или заданию, а компьютер, получая данные о маркерах с камер – сводит все эти данные в единую 3Д-модель, повторяющую движения, мимику и черты актера. Данная система может работать как в реальном времени, так и просто быть основой для дальнейшей обработки.

Безмаркерные системы. В данных системах не требуется применение каких-либо специальных устройств, которые бы крепились на человека – безмаркерные системы основаны на применении средств компьютерного зрения и средств распознавания образов. Отсутствие «лишнего» на актере позволяет как ускорить процесс захвата движений, так и записывать более сложные движения без риска травм актёров и повреждения дорогостоящего оборудования.

Маркерные системы можно разделить на:
\begin{itemize}
	\item Пассивные оптические системы. В пассивных системах маркеры на актере лишь отражают посланный на них специальными стробоскопами камер инфракрасный свет, показывая тем самым свою позицию на костюме. Минусами данного подхода являются: Большие временные затраты на установку и крепление датчиков на актере, плохое различение датчиков при быстром их перемещении или близком расположении относительно друг друга.
	\item В оптических активных системах, напротив, используются системы посылающих сигнал светодиодов и контроллеров, синхронизирующих светодиоды друг с другом, а всю систему с сервером. В остальном работа оптической активной системы схожа с работой оптической пассивной. Из минусов можно выделить невозможность захвата лицевой анимации, необходимость крепления к актеру дополнительного оборудования – контроллера, хрупкость и высокая стоимость.
	\item Магнитные системы. Здесь в качестве маркеров используются магниты, а в качестве «камер» - уловители магнитного потока, которые определяют положения датчиков по изменению ЭМ-поля. Из минусов – подверженность внешнему электрическому воздействию, меньшая зона работы по сравнению с оптическими системами. Остальные минусы схожи с минусами оптических активных систем.
	\item Механические системы используют специальный костюм-скелет, который напрямую отслеживает положение каждого сгиба и вращений суставов. Минусы: сам скелет, различные контроллеры и провода сильно сковывают актера в движениях, нет возможности захвата анимаций лица, возможности определять взаимодействия нескольких актеров в одной сцене.
	\item Гироскопические и инерциальные системы. Здесь данные с сенсоров (например его положение, угол наклона) передаются в компьютер, где уже непосредственно происходит запись этих жанных и их обработка. Минусы – нет захвата мимики, высокая стоимость, все равно необходимо наличие оптической или магнитной системы для определения положения актера в сцене.
\end{itemize}

Преимущества систем захвата движений:
\begin{itemize}
	\item результат работы получаем в реальном времени, что значительно снижает затраты относительно покадровой анимации.
	\item объём работы не зависит от сложности или длинны задачи, как если бы применялся традиционный покадровый подход. Motion capture позволяет снимать большое количество дублей одной и той же сцены, но в разных стилях и с разной подачей
	\item сложные движения и реалистичные физические взаимодействия, как например вес или столкновения могут быть легко записаны, при этом будучи физически корректными.
	\item количество анимационных данных, которые могут быть записаны за короткий срок огромны, если сравнивать с традиционными техниками в анимации. Это экономически эффективно, а также позволяет легче укладываться в сроки проекта.
	\item стоимость варьируется от нуля до бесконечночти, что позвляет достаточно легко подобрать тот вариант, который качественно и количественно лучше всех подойдет для проекта.
\end{itemize}

Недостатки:
\begin{itemize}
	\item необходимость в дополнительном ПО, зачастую не входящем в основные пакеты, в которых создаётся анимация
	\item для некоторых систем захвата движений могут существовать требования к размерам помещения и его электромагнитным свойствам.
	\item при возникновении проблемы в процессе записи анимации становится проще переснять дубль полностью, чем его редактировать, но не все системы позволяют отсматривать результат в реальном времени, чтобы определить, необходимо ли переснять дубль.
	\item трансформации объекта ограничены возможностями объекта захвата, поэтому все дополнительные преобразования всё равно будет необходимо делать позднее.
	\item несовпадение параметров компьютерной модели и объекта съёмки могут привести к различным артефактам.
\end{itemize}



\subsection{Сравнение с аналогами}
Существует несколько распространенных программных продуктов, которые являются аналогами данной работы.

Первый и основной - инструмент Tracking раздела Movie Clip editor, встроенный в пакет Blender \cite{cgmatter-ytb}.

Данный инструмент можно отнести к виду пассивных оптических систем. Для коррректной работы необходимо нанести на лицо специальные маркеры, каждый из которых затем вручную выделяется специальными рамками-трекерами, которые и будут отслеживать изменение координат маркеров на лице и записывать их путь.(рис. \ref{marker}).
\addimghere{markercgmatter}{0.7}{Интерфейс Blender в режиме трекинга маркеров}{marker}

Далее, инструментом Link empty to track точки привязываются к камере уже в 3Д пространстве, после чего необходимо вручную привязать соответствующие точки к соответствующим костям (рис. \ref{empty}).
\addimghere{empties}{0.7}{Модель с привязанными к трекерам костями}{empty}

Плюсами данного метода являются:
\begin{itemize}
	\item данный инструмент является стандартным для пакета трехмерного моделирования Blender.
	\item много настроек для повышения качества отслеживания маркеров
	\item может работать как с видеофайлами, так и с последовательностями картинок
	\item прост и понятен в использовании
\end{itemize}
Минусы данного метода:
\begin{itemize}
	\item не реального времени
	\item необходимо использовать маркеры для трекинга
	\item для лучшего качества отслеживания желательно перевести видео в секвенцию кадров
	\item связать точки не с моделью лица, с которого делался трекинг можно, но придется пожертвовать "красивым" расположением костей
\end{itemize}

Второй инструмент - программа FaceCap от niels jansson \cite{facecap}. 

Используя TrueDepth сенсор устройства поддерживаемого устройства на iOS, можно записывать и экспортировать FBX файлы включающие в себя меш, ключи формы (shape keys, blend shapes) и данные об изменениях модели. Также можно экспортировать отдельно данные об анимации в текстовый файл.

Плюсы:
\begin{itemize}
	\item основной функционал бесплатен
	\item используется безмаркерная оптическая система для захвата движений
	\item можно в реальном времени следить за захватом лица на базовой модели
\end{itemize}

Минусы:
\begin{itemize}
	\item только iOS
	\item полный функционал открывается за 60 долларов
	\item нет возможности переносить анимацию в реальном времени на модель в Blender
\end{itemize}

В качестве третьего аналога рассмотрим десктопное проприетарное приложение iClone7 \cite{iclone}.

Данное ПО позволяет загрузить готовую модель из Blender со всеми материалами и уже её анимировать в реальном времени с помощью вебкамеры компьютера или ноутбука.

Плюсы iClone7:
\begin{itemize}
	\item захват анимации в реальном времени
	\item возможность использования готовых моделей из различных пакетов компьютерной графики.
\end{itemize}
Минусы:
\begin{itemize}
	\item стоимость программы iClone7 - 200 долларов
	\item стоимость аддона 3DXchange 7 для экспортирования заанимированной модели в Blender - 500 долларов
\end{itemize}


\subsection{Решаемые задачи}


Решаемыми задачами в данной работе являются:
\begin{itemize}
	\item изучение доступных средств пакета Blender и библиотек компьютерного зрения
	\item проектирование структуры плагина
	\item изучение API Blender3D и функций библиотек 
	\item написание плагина с графическим интерфейсом, работающего внутри пакета Blender
\end{itemize}


\clearpage
